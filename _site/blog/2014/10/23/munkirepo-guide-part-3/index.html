<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Setup Munkireport on Ubuntu 14.04 - Part 3 &#8211; Just another tech blog</title>
<meta name="description" content="Install Munkireport-php on our munki server to give us a powerful reporting console for munki clients.">
<meta name="keywords" content="">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Setup Munkireport on Ubuntu 14.04 - Part 3">
<meta name="twitter:description" content="Install Munkireport-php on our munki server to give us a powerful reporting console for munki clients.">
<meta name="twitter:site" content="@clburlison">
<meta name="twitter:creator" content="@clburlison">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://clburlison.com/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Setup Munkireport on Ubuntu 14.04 - Part 3">
<meta property="og:description" content="Install Munkireport-php on our munki server to give us a powerful reporting console for munki clients.">
<meta property="og:url" content="https://clburlison.com/blog/2014/10/23/munkirepo-guide-part-3/">
<meta property="og:site_name" content="Just another tech blog">





<link rel="canonical" href="https://clburlison.com/blog/2014/10/23/munkirepo-guide-part-3/">
<link href="https://clburlison.com/feed.xml" type="application/atom+xml" rel="alternate" title="Just another tech blog Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://clburlison.com/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="https://clburlison.com/assets/js/vendor/html5shiv.min.js"></script>
	<script src="https://clburlison.com/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="https://clburlison.com/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://clburlison.com/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://clburlison.com/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://clburlison.com/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://clburlison.com/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://clburlison.com/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://clburlison.com/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="https://clburlison.com">Just another tech blog</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
					    
					        
					    
					    <li><a href="https://clburlison.com/about/" >About</a></li>
					  
					    
					        
					    
					    <li><a href="https://clburlison.com/resources/" >Resources</a></li>
					  
					    
					        
					    
					    <li><a href="https://clburlison.com/blog/archives/" >Archives</a></li>
					  
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    



	<img src="https://clburlison.com/images/me.jpg" class="bio-photo" alt="Clayton Burlison bio photo"></a>

<h3>Clayton Burlison</h3>
<p>A Mac sysadmin, documenting useful code, ideas, & guides.</p>
<a href="mailto:clburlison@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/clburlison" class="author-social" target="_blank"><i class="fa fa-twitter-square"></i> Twitter</a>


<a href="http://linkedin.com/in/clburlison" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/clburlison" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="https://clburlison.com/blog/2014/10/23/munkirepo-guide-part-3/" rel="bookmark" title="Setup Munkireport on Ubuntu 14.04 - Part 3">Setup Munkireport on Ubuntu 14.04 - Part 3</a></h1>
      
    Categories: 

<span class="categories">
  
    <a class='category' href='/blog/categories/munki/'>munki</a>, <a class='category' href='/blog/categories/munkireport/'>munkireport</a>, <a class='category' href='/blog/categories/ubuntu/'>ubuntu</a>
  
</span>

	 
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <section id="table-of-contents" class="toc">
  <header>
    <h3>Overview</h3>
  </header>
<div id="drawer">
<ul id="markdown-toc">
  <li><a href="#intro">Intro</a></li>
  <li><a href="#the-install">The Install</a>    <ul>
      <li><a href="#installing-required-software">Installing Required Software</a></li>
      <li><a href="#setup-mysql">Setup MySQL</a>        <ul>
          <li><a href="#creating-the-database">Creating the database</a></li>
        </ul>
      </li>
      <li><a href="#configure-php">Configure php</a></li>
      <li><a href="#downloading-munkireport">Downloading MunkiReport</a></li>
      <li><a href="#configure-nginx-for-munkireport">Configure nginx for MunkiReport</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#apendium-1---connecting-a-client-to-munkireport">Apendium 1 - connecting a client to MunkiReport</a></li>
  <li><a href="#apendium-2---adding-munkireport-to-your-munkirepo">Apendium 2 - adding MunkiReport to your munki_repo</a></li>
</ul>

  </div>
</section>
<!-- /#table-of-contents -->

<h1 id="intro">Intro</h1>
<p>Welcome to the third part in our munki server setup series. In this section, we will download and configure <a href="https://github.com/munkireport/munkireport-php">Munkireport-php</a> on our munki server.</p>

<p>Before we get to far you might want to head over to <a href="/blog/2014/10/06/munkirepo-guide-part-1/">Part 1 - Setting up the munki repo</a> or <a href="/blog/2014/10/19/munkirepo-guide-part-2/">Part 2 - Setting up mandrill</a>. Parts 1 and 2 are not technically required for MunkiReport by you will want to have an understanding of how the other components of your munki server work before setting up the reporting server. </p>

<p>If you have no idea what MunkiReport is go check out this <a href="https://munkireportphp-nbalonso.rhcloud.com/">Demo site</a> hosted by <a href="http://www.nbalonso.com/">Noel</a>. Noel has a custom color scheme but it should give you an idea of the system.</p>

<p><img src="/images/posts/2014-10-23/mr.png" width="600" /></p>

<h1 id="the-install">The Install</h1>
<p>Munkireport is a web application written in php that displays useful stats about your munki fleet. The resources taken up by MunkiReport are quite small but like all web apps if you client base grows very large you will want to make sure the database can keep up. With that you can install MunkiReport on any compatible web-server (IIS, apache, or nginx) for this guide we will be using our munki server from Parts 1 &amp; 2 as our reporting server.</p>

<p>Part of this installation includes setting up MySQL as our database backend. SQLite is the default database but I highly recommend setting my MySQL since the <a href="https://github.com/munkireport/munkireport-php/wiki/Performance">performance</a> gains are high and setup only takes a few more steps, not to mention SQLite will start to choke when higher volumes of clients start to check-in with the reporting server. </p>

<p>It is also important to note, I like MunkiReport to be hosted on a sub-directory. This means when connecting to MuniReport you will type <a href="">http://yourserver.example.com/report/</a> to access the site. If you want a different setup, you will need to make the necessary changes.</p>

<h2 id="installing-required-software">Installing Required Software</h2>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo apt-get update
sudo apt-get -y install nginx git php5-fpm php5-mysql php5-ldap</code></pre></div>

<p><em>Note:</em> the <code>php5-ldap</code> package is only needed if you are planning on connecting to an Active Directory or LDAP directory for authenticating to MunkiReport. </p>

<h2 id="setup-mysql">Setup MySQL</h2>

<p>Lets install MySQL</p>

<p><code>sudo apt-get install mysql-client mysql-server</code></p>

<p><strong>This will prompt you to create the root mysql database account. Do not forget the password you set.</strong></p>

<p>Now, we need to tell MySQL to generate the directory structure it needs to store its databases and information. We can do this by typing:</p>

<p><code>sudo mysql_install_db</code></p>

<p>Next, you can optionally run a simple security script that will prompt you to modify some insecure defaults (this is highly recommended on production servers). Begin the script by typing:</p>

<p><code>sudo mysql_secure_installation</code></p>

<p>You will need to enter the MySQL root password that you selected during installation.</p>

<p>During the secure installation script it will ask if you want to change the root password. If you are happy with your MySQL root password, type “N” for no and hit “ENTER”. Afterwards, you will be prompted to remove some test users and databases. You should choice “Y” and hit “enter” through these prompts to remove the “unsafe” defaults from installation.</p>

<p>Once the script has been run, MySQL is ready to go.</p>

<h3 id="creating-the-database">Creating the database</h3>

<p>Lets create our MunkiReport database with the name of <code>munkireport</code>. We will also create a database user and password. Change <em>USERNAME</em> and <em>PASSWORD</em> to your preference. Note the database username that is created below is what you will enter into your config.php in the following steps. It is bad practice to use the root account for database entry.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&quot;CREATE DATABASE munkireport CHARACTER SET utf8 COLLATE utf8_bin;&quot;</span> <span class="p">|</span> mysql -u root -p
<span class="nb">echo</span> <span class="s2">&quot;CREATE USER &#39;USERNAME&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;PASSWORD&#39;;&quot;</span> <span class="p">|</span> mysql -u root -p
<span class="nb">echo</span> <span class="s2">&quot;GRANT ALL PRIVILEGES ON munkireport.* TO &#39;USERNAME&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;PASSWORD&#39;;&quot;</span> <span class="p">|</span> mysql -u root -p
<span class="nb">echo</span> <span class="s2">&quot;FLUSH PRIVILEGES;&quot;</span> <span class="p">|</span> mysql -u root -p</code></pre></div>

<h2 id="configure-php">Configure php</h2>
<p>Lets make one small change to the default php configuration.</p>

<p><code>sudo nano /etc/php5/fpm/php.ini</code></p>

<p>Find the line, <strong>cgi.fix_pathinfo=1</strong>, and change the <strong>1 to 0</strong>. Also, uncomment this line to enable this security setting. The file should now look like the below excerpt:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">&lt;---------------

<span class="p">;</span> cgi.fix_pathinfo provides *real* PATH_INFO/PATH_TRANSLATED support <span class="k">for</span> CGI.  PHP<span class="err">&#39;</span>s
<span class="p">;</span> previous behaviour was to <span class="nb">set </span>PATH_TRANSLATED to SCRIPT_FILENAME, and to not grok
<span class="p">;</span> what PATH_INFO is.  For more information on PATH_INFO, see the cgi specs.  Setting
<span class="p">;</span> this to <span class="m">1</span> will cause PHP CGI to fix its paths to conform to the spec.  A setting
<span class="p">;</span> of zero causes PHP to behave as before.  Default is 1.  You should fix your scripts
<span class="p">;</span> to use SCRIPT_FILENAME rather than PATH_TRANSLATED.
<span class="p">;</span> http://php.net/cgi.fix-pathinfo
cgi.fix_pathinfo<span class="o">=</span>0

---------------&gt;</code></pre></div>

<p>If this number is kept as 1, the php interpreter will do its best to process the file that is as near to the requested file as possible. This is a possible security risk. If this number is set to 0, conversely, the interpreter will only process the exact file path—a much safer alternative. Save and Exit. </p>

<p>Now, restart php-fpm for the change to take affect:</p>

<p><code>sudo service php5-fpm restart</code></p>

<h2 id="downloading-munkireport">Downloading MunkiReport</h2>

<p>We are finally to the point that we can start getting MunkiReport setup.</p>

<p><code>sudo git clone https://github.com/munkireport/munkireport-php /usr/share/nginx/html/report</code></p>

<p>At this point, lets create a link to our report folder for our local Ubuntu admin, this allows us to make modifications easier in the future. </p>

<p><code>sudo ln -s /usr/share/nginx/html/report ~/report</code></p>

<p>MunkiReport requires a config.php, this is your settings for MunkiReport. Below are some defaults that I think most users will want. For a full list of options please visit <a href="https://github.com/munkireport/munkireport-php/blob/master/config_default.php">here</a>.</p>

<p>You will want to change  the following in your config.php file: </p>

<ul>
  <li>sitename = change Company to something useful</li>
  <li>allow_migrations = you will want to change this to true for MunkiReport updates</li>
  <li>debug = change this to false if you don’t need debugging</li>
  <li>timezone = for your <a href="http://en.wikipedia.org/wiki/List_of_tz_database_time_zones">timezone</a></li>
  <li>ssh = change <em>ladmin</em> to your company local mac admin account</li>
  <li>locale = change to location</li>
  <li>lang = change to your language</li>
</ul>

<p>The root account is created for you, for testing purposes. You will want to create your own admin account by visiting <a href="http://yourserver.example.com/report/auth/generate">http://yourserver/report/auth/generate</a>.</p>

<p>The last section of the config file deals with out MySQL database. You will want to change the username and password to match what you created in the previous step.</p>

<p><code>sudo nano /usr/share/nginx/html/report/config.php</code></p>

<div class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nb">defined</span><span class="p">(</span> <span class="s1">&#39;KISS&#39;</span> <span class="p">)</span> <span class="p">)</span> <span class="k">exit</span><span class="p">;</span>

<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;index_page&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;index.php?&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;sitename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Company - MunkiReport&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;allow_migrations&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;timezone&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">@</span><span class="nb">date_default_timezone_get</span><span class="p">(</span><span class="nx">America</span><span class="o">/</span><span class="nx">Chicago</span><span class="p">);</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;vnc_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;vnc://%s:5900&quot;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;ssh_link&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;ssh://ladmin@%s&quot;</span><span class="p">;</span>
<span class="nb">ini_set</span><span class="p">(</span><span class="s1">&#39;session.cookie_lifetime&#39;</span><span class="p">,</span> <span class="mi">43200</span><span class="p">);</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;locale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en_US&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;lang&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;en&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;keep_previous_displays&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">|===============================================</span>
<span class="cm">| Authorized Users of Munki Report</span>
<span class="cm">|===============================================</span>
<span class="cm">| Visit http://munki/report/auth/generate to generate additional local values</span>
<span class="cm">*/</span>
<span class="nv">$auth_config</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;$P$BUqxGuzR2VfbSvOtjxlwsHTLIMTmuw0&#39;</span><span class="p">;</span> <span class="c1">// Password is root</span>

<span class="cm">/*</span>
<span class="cm">|===============================================</span>
<span class="cm">| PDO Datasource</span>
<span class="cm">|===============================================</span>
<span class="cm">*/</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;pdo_dsn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;mysql:host=localhost;dbname=munkireport&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;pdo_user&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;munki&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;pdo_pass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;munki&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="p">[</span><span class="s1">&#39;pdo_opts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">MYSQL_ATTR_INIT_COMMAND</span> <span class="o">=&gt;</span> <span class="s1">&#39;SET NAMES utf8&#39;</span><span class="p">);</span></code></pre></div>

<p>We are an Active Directory shop at my work place and for that reason I really like the ability for MunkiReport to pull an AD group and give access (remember the php5-ldap package we installed earlier). Unfortunately, in my current testing this function is slightly broken at the moment. When attempting to login to MunkiReport using AD Group Authorization you will be presented a white screen. A refresh on the blank screen along with a “Resend form data” will get you to the dashboard. This is a pretty annoying inconvenience, so at this moment I have simply added our report administrators into the ‘allowed_users’ line in my config.php.  </p>

<p>Below are the additional settings need to make Active Directory work with MunkiReport:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">// Below are the options <span class="k">for</span> Active Directory user authorization
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;account_suffix&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;@example.com&#39;</span><span class="p">;</span>
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;base_dn&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="nv">dc</span><span class="o">=</span>example,dc<span class="o">=</span>come<span class="p">;</span> //set to NULL to auto-detect
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;domain_controllers&#39;</span><span class="o">]</span> <span class="o">=</span> array<span class="o">(</span><span class="s1">&#39;server1.example.com&#39;</span>,<span class="s1">&#39;server2.example.com&#39;</span><span class="o">)</span><span class="p">;</span> //can be an array of servers
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;admin_username&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;admin&#39;</span><span class="p">;</span> //if needed to perform the search
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;admin_password&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;munki_is_cool&#39;</span><span class="p">;</span> //if needed to perform the search
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;mr_allowed_users&#39;</span><span class="o">]</span> <span class="o">=</span> array<span class="o">(</span><span class="s1">&#39;userA&#39;</span>,<span class="s1">&#39;userB&#39;</span>,<span class="s1">&#39;userC&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="nv">$conf</span><span class="o">[</span><span class="s1">&#39;auth&#39;</span><span class="o">][</span><span class="s1">&#39;auth_AD&#39;</span><span class="o">][</span><span class="s1">&#39;mr_allowed_groups&#39;</span><span class="o">]</span> <span class="o">=</span> array<span class="o">(</span><span class="s1">&#39;MunkiReportAdmins&#39;</span><span class="o">)</span><span class="p">;</span> //case sensitive</code></pre></div>

<h2 id="configure-nginx-for-munkireport">Configure nginx for MunkiReport</h2>

<p>Lets configure nginx to use <a href="http://yourserver.example.com/report">http://yourserver.example.com/report</a></p>

<p><code>sudo nano /etc/nginx/sites-enabled/default</code>  </p>

<p><em>Note:</em> make sure and change your server_name. This file also takes care of our munki_repo from <a href="/blog/2014/10/06/munkirepo-guide-part-1/">Part 1</a>.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">server <span class="o">{</span>
	listen <span class="m">80</span> default_server<span class="p">;</span>
	listen <span class="o">[</span>::<span class="o">]</span>:80 default_server <span class="nv">ipv6only</span><span class="o">=</span>on<span class="p">;</span>

	root /usr/share/nginx/html<span class="p">;</span>
	index index.php index.html index.htm<span class="p">;</span>

	server_name munki<span class="p">;</span>
	    
    error_page <span class="m">404</span> /404.html<span class="p">;</span>
    error_page <span class="m">500</span> <span class="m">502</span> <span class="m">503</span> <span class="m">504</span> /50x.html<span class="p">;</span>
    <span class="nv">location</span> <span class="o">=</span> /50x.html <span class="o">{</span>
        root /usr/share/nginx/html<span class="p">;</span>
    <span class="o">}</span>

    location /report <span class="o">{</span>
        try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
    <span class="o">}</span>

    location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
        try_files <span class="nv">$uri</span> <span class="o">=</span>404<span class="p">;</span>
        fastcgi_split_path_info ^<span class="o">(</span>.+<span class="se">\.</span>php<span class="o">)(</span>/.+<span class="o">)</span><span class="nv">$;</span>
        fastcgi_pass unix:/var/run/php5-fpm.sock<span class="p">;</span>
        fastcgi_index index.php<span class="p">;</span>
        include fastcgi_params<span class="p">;</span>
    <span class="o">}</span>

    location /munki_repo/ <span class="o">{</span>
      <span class="nb">alias</span> /usr/local/munki_repo/<span class="p">;</span>
      autoindex off<span class="p">;</span>
      auth_basic <span class="s2">&quot;Restricted&quot;</span><span class="p">;</span>
      auth_basic_user_file /etc/nginx/.htpasswd<span class="p">;</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre></div>

<p>We must change our nginx default settings for php to work. </p>

<p><code>sudo nano /etc/nginx/nginx.conf</code></p>

<p>Look for <code>default_type  application/octet-stream;</code> and comment this line out. Check out the below excerpt:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">&lt;---------------

<span class="c"># server_names_hash_bucket_size 64;</span>
        <span class="c"># server_name_in_redirect off;</span>

        include /etc/nginx/mime.types<span class="p">;</span>
        <span class="c">#default_type application/octet-stream; //comment me out for MunkiReport to work</span>

        <span class="c">##</span>
        <span class="c"># Logging Settings</span>
        <span class="c">##</span>

---------------&gt;</code></pre></div>

<p>To test your nginx configuration run the following command. This will make sure that you have no errors.</p>

<p><code>sudo nginx -c /etc/nginx/nginx.conf -t</code></p>

<p>Restart Nginx to make the necessary changes:</p>

<p><code>sudo service nginx restart</code></p>

<h1 id="conclusion">Conclusion</h1>
<p>You should now have a basic MunkiReport configuration up and running. Double check that everything is working by visiting <a href="http://youserver.example.com/report/">http://youserver.example.com/report/</a>. Remember the default username and password, <code>root</code>. For more settings and additional information please visit the Wiki for <a href="https://github.com/munkireport/munkireport-php/wiki">MunkiReport</a>.</p>

<p>As always feel free to drop a comment below or on Twitter. Feedback is always appreciated.</p>

<hr />

<h1 id="apendium-1---connecting-a-client-to-munkireport">Apendium 1 - connecting a client to MunkiReport</h1>
<p>If you would like to connect a single munki client to MunkiReport you can use the following command:</p>

<p><code>sudo /bin/bash -c "$(curl -s http://yourserver.example.com/report/index.php?/install)"</code></p>

<h1 id="apendium-2---adding-munkireport-to-your-munkirepo">Apendium 2 - adding MunkiReport to your munki_repo</h1>
<p>To add multiple Munki clients to MunkiReport we should use munki. To get a generated plist file that you can drop into your <em>munki_repo/pkginfo</em> directory run the following command.</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">curl -s https://yourserver.example.com/report/index.php?/install/plist -o <span class="se">\</span>
~/Desktop/MunkiReport.plist</code></pre></div>

<p>The output file will end up on your Desktop for easy transfer to your repo.</p>

<hr />

<p>Articles:<br />
<a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-on-ubuntu-14-04">Install LEMP stack on Ubuntu 14.04</a>,<br />
<a href="https://github.com/munkireport/munkireport-php/wiki">Munkireport Wiki</a>,<br />
<a href="http://www.nbalonso.com/new-munkireport-php-2/">nbalonso Munkireport-php</a>,  </p>

<p>Updated: Oct. 24, 2014 - Spelling</p>

      <footer role="contentinfo">
        <div class="article-author-bottom">
          



	<img src="https://clburlison.com/images/me.jpg" class="bio-photo" alt="Clayton Burlison bio photo"></a>

<h3>Clayton Burlison</h3>
<p>A Mac sysadmin, documenting useful code, ideas, & guides.</p>
<a href="mailto:clburlison@gmail.com" class="author-social" target="_blank"><i class="fa fa-envelope-square"></i> Email</a>
<a href="http://twitter.com/clburlison" class="author-social" target="_blank"><i class="fa fa-twitter-square"></i> Twitter</a>


<a href="http://linkedin.com/in/clburlison" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>


<a href="http://github.com/clburlison" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






        </div>
        <p><b>Published: </b><time datetime="2014-10-23T00:00:00-05:00">October 23, 2014</time><br>
		<b>Modified:</b> <time datetime="2014-10-24">October 24, 2014</time></p>
      </footer>
    </div><!-- /.article-wrap -->
    <center><nav class="pagination" role="navigation">
      
        <a href="https://clburlison.com/blog/2014/10/19/munkirepo-guide-part-2/" class="btn" title="Setup Mandrill on Ubuntu 14.04 - Part 2">Previous article</a>
      
      
    </nav><!-- /.pagination --></center>
    <hr />
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">

  <footer>
    <div class="google-ads">
  <!-- 320 x 50 ad -->
  <script async src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
       style="display:inline-block;width:320px;height:50px"
       data-ad-client=""
       data-ad-slot=""></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</div><!-- /.google-ads -->

<span>&copy; 2014 Clayton Burlison. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://clburlison.com/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://clburlison.com/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'clburlison'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>